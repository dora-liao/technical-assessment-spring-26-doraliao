{"ast":null,"code":"var _jsxFileName = \"/Users/doraliao/Desktop/Impact Team Project/src/components/PollQuestion.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useCallback } from \"react\";\nimport { supabase } from \"../supabaseClient\";\nimport \"./PollQuestion.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PollQuestion = ({\n  questionId,\n  userId\n}) => {\n  _s();\n  // Ask name ONCE per page\n  const getOrAskName = () => {\n    const key = `poll_name_page_${questionId}`;\n    let name = localStorage.getItem(key);\n    if (!name) {\n      name = prompt(\"Enter your name to vote:\") || \"Anonymous\";\n      localStorage.setItem(key, name);\n    }\n    return name;\n  };\n  const userName = getOrAskName();\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState([]);\n  const [userVote, setUserVote] = useState(null);\n  const [feedback, setFeedback] = useState(null);\n  const fetchPoll = useCallback(async () => {\n    var _currentVote$option_i;\n    const {\n      data: qData\n    } = await supabase.from(\"poll_questions\").select(\"*\").eq(\"id\", questionId).single();\n    if (qData) setQuestion(qData.question_text);\n    const {\n      data: oData\n    } = await supabase.from(\"poll_options\").select(\"*\").eq(\"question_id\", questionId).order(\"id\");\n    const {\n      data: votesData\n    } = await supabase.from(\"poll_votes\").select(\"*\").eq(\"question_id\", questionId);\n\n    // attach voters\n    const combined = (oData === null || oData === void 0 ? void 0 : oData.map(opt => ({\n      ...opt,\n      voters: (votesData === null || votesData === void 0 ? void 0 : votesData.filter(v => v.option_id === opt.id).map(v => v.user_name)) || []\n    }))) || [];\n    setOptions(combined);\n\n    // find the user's current vote\n    const currentVote = votesData === null || votesData === void 0 ? void 0 : votesData.find(v => v.user_id === userId);\n    setUserVote((_currentVote$option_i = currentVote === null || currentVote === void 0 ? void 0 : currentVote.option_id) !== null && _currentVote$option_i !== void 0 ? _currentVote$option_i : null);\n  }, [questionId, userId]);\n\n  // realtime listener for vote changes\n  useEffect(() => {\n    fetchPoll();\n    const channel = supabase.channel(`poll-${questionId}`).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"poll_options\"\n    }, () => fetchPoll() // Always refresh cleanly\n    ).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"poll_votes\"\n    }, () => fetchPoll()).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchPoll, questionId]);\n  const handleVote = async option => {\n    setFeedback(option.is_correct ? \"Correct!\" : \"Incorrect — try again!\");\n\n    // Remove old vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", {\n        option_id: userVote\n      });\n      await supabase.from(\"poll_votes\").delete().eq(\"question_id\", questionId).eq(\"user_id\", userId);\n    }\n\n    // Add new vote\n    await supabase.rpc(\"increment_vote\", {\n      option_id: option.id\n    });\n    await supabase.from(\"poll_votes\").insert({\n      question_id: questionId,\n      option_id: option.id,\n      user_id: userId,\n      user_name: userName\n    });\n    setUserVote(option.id);\n  };\n  const totalVotes = options.reduce((s, o) => s + o.votes, 0);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"poll-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"poll-question\",\n      children: question\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"poll-options-grid\",\n      children: options.map(option => {\n        const isChosen = userVote === option.id;\n        const percentage = totalVotes === 0 ? 0 : Math.round(option.votes / totalVotes * 100);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `poll-option-card ${isChosen ? \"selected\" : \"\"}`,\n          onClick: () => handleVote(option),\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"option-text\",\n            children: option.option_text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"option-votes\",\n            children: [percentage, \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 15\n          }, this), option.voters.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"voters-list\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Chosen by:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 19\n            }, this), \" \", option.voters.join(\", \")]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 17\n          }, this)]\n        }, option.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this), feedback && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"poll-feedback\",\n      children: feedback\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 20\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 5\n  }, this);\n};\n_s(PollQuestion, \"p0IL7syA3q5YpUS7bH2qLN3OVR4=\");\n_c = PollQuestion;\nexport default PollQuestion;\nvar _c;\n$RefreshReg$(_c, \"PollQuestion\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","supabase","jsxDEV","_jsxDEV","PollQuestion","questionId","userId","_s","getOrAskName","key","name","localStorage","getItem","prompt","setItem","userName","question","setQuestion","options","setOptions","userVote","setUserVote","feedback","setFeedback","fetchPoll","_currentVote$option_i","data","qData","from","select","eq","single","question_text","oData","order","votesData","combined","map","opt","voters","filter","v","option_id","id","user_name","currentVote","find","user_id","channel","on","event","schema","table","subscribe","removeChannel","handleVote","option","is_correct","rpc","delete","insert","question_id","totalVotes","reduce","s","o","votes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","isChosen","percentage","Math","round","onClick","option_text","length","join","_c","$RefreshReg$"],"sources":["/Users/doraliao/Desktop/Impact Team Project/src/components/PollQuestion.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\nimport { supabase } from \"../supabaseClient\";\nimport \"./PollQuestion.css\";\n\ninterface PollOption {\n  id: number;\n  question_id: number;\n  option_text: string;\n  votes: number;\n  is_correct: boolean;\n  voters: string[];\n}\n\ninterface PollQuestionProps {\n  questionId: number;\n  userId: string;\n}\n\nconst PollQuestion: React.FC<PollQuestionProps> = ({ questionId, userId }) => {\n  // Ask name ONCE per page\n  const getOrAskName = () => {\n    const key = `poll_name_page_${questionId}`;\n    let name = localStorage.getItem(key);\n    if (!name) {\n      name = prompt(\"Enter your name to vote:\") || \"Anonymous\";\n      localStorage.setItem(key, name);\n    }\n    return name;\n  };\n\n  const userName = getOrAskName();\n\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState<PollOption[]>([]);\n  const [userVote, setUserVote] = useState<number | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n\n  const fetchPoll = useCallback(async () => {\n    const { data: qData } = await supabase\n      .from(\"poll_questions\")\n      .select(\"*\")\n      .eq(\"id\", questionId)\n      .single();\n\n    if (qData) setQuestion(qData.question_text);\n\n    const { data: oData } = await supabase\n      .from(\"poll_options\")\n      .select(\"*\")\n      .eq(\"question_id\", questionId)\n      .order(\"id\");\n\n    const { data: votesData } = await supabase\n      .from(\"poll_votes\")\n      .select(\"*\")\n      .eq(\"question_id\", questionId);\n\n    // attach voters\n    const combined =\n      oData?.map((opt: any) => ({\n        ...opt,\n        voters: votesData\n          ?.filter((v) => v.option_id === opt.id)\n          .map((v) => v.user_name) || [],\n      })) || [];\n\n    setOptions(combined);\n\n    // find the user's current vote\n    const currentVote = votesData?.find((v) => v.user_id === userId);\n    setUserVote(currentVote?.option_id ?? null);\n  }, [questionId, userId]);\n\n  // realtime listener for vote changes\n  useEffect(() => {\n    fetchPoll();\n\n    const channel = supabase\n      .channel(`poll-${questionId}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"*\",\n          schema: \"public\",\n          table: \"poll_options\",\n        },\n        () => fetchPoll() // Always refresh cleanly\n      )\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"*\",\n          schema: \"public\",\n          table: \"poll_votes\",\n        },\n        () => fetchPoll()\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchPoll, questionId]);\n\n  const handleVote = async (option: PollOption) => {\n    setFeedback(option.is_correct ? \"Correct!\" : \"Incorrect — try again!\");\n\n    // Remove old vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", { option_id: userVote });\n\n      await supabase\n        .from(\"poll_votes\")\n        .delete()\n        .eq(\"question_id\", questionId)\n        .eq(\"user_id\", userId);\n    }\n\n    // Add new vote\n    await supabase.rpc(\"increment_vote\", { option_id: option.id });\n\n    await supabase.from(\"poll_votes\").insert({\n      question_id: questionId,\n      option_id: option.id,\n      user_id: userId,\n      user_name: userName,\n    });\n\n    setUserVote(option.id);\n  };\n\n  const totalVotes = options.reduce((s, o) => s + o.votes, 0);\n\n  return (\n    <div className=\"poll-container\">\n      <h3 className=\"poll-question\">{question}</h3>\n\n      <div className=\"poll-options-grid\">\n        {options.map((option) => {\n          const isChosen = userVote === option.id;\n          const percentage =\n            totalVotes === 0 ? 0 : Math.round((option.votes / totalVotes) * 100);\n\n          return (\n            <div\n              key={option.id}\n              className={`poll-option-card ${isChosen ? \"selected\" : \"\"}`}\n              onClick={() => handleVote(option)}\n            >\n              <p className=\"option-text\">{option.option_text}</p>\n              <p className=\"option-votes\">{percentage}%</p>\n\n              {option.voters.length > 0 && (\n                <p className=\"voters-list\">\n                  <strong>Chosen by:</strong> {option.voters.join(\", \")}\n                </p>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {feedback && <p className=\"poll-feedback\">{feedback}</p>}\n    </div>\n  );\n};\n\nexport default PollQuestion;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}