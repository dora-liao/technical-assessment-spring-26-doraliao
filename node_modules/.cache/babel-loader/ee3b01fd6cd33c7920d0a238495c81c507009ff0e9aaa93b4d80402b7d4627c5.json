{"ast":null,"code":"var _jsxFileName = \"/Users/doraliao/Desktop/Impact Team Project/Impact Team Project/src/components/PollQuestion.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../supabaseClient\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PollQuestion = ({\n  questionId,\n  userId\n}) => {\n  _s();\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState([]);\n  const [userVote, setUserVote] = useState(null);\n  const [feedback, setFeedback] = useState(null);\n\n  // Fetch question + options\n  const fetchPoll = async () => {\n    const {\n      data: qData,\n      error: qError\n    } = await supabase.from(\"poll_questions\").select().eq(\"id\", questionId).single();\n    if (qError) console.error(qError);else setQuestion(qData.question_text);\n    const {\n      data: oData,\n      error: oError\n    } = await supabase.from(\"poll_options\").select().eq(\"question_id\", questionId).order(\"id\");\n    if (oError) console.error(oError);else setOptions(oData);\n    const {\n      data: vData\n    } = await supabase.from(\"poll_votes\").select().eq(\"question_id\", questionId).eq(\"user_id\", userId).maybeSingle();\n    if (vData) setUserVote(vData.option_id);\n  };\n\n  // Realtime listener\n  useEffect(() => {\n    fetchPoll();\n    const channel = supabase.channel(`poll-${questionId}`).on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"poll_options\",\n      filter: `question_id=eq.${questionId}`\n    }, payload => {\n      if (payload.eventType === \"UPDATE\") {\n        setOptions(prev => prev.map(o => o.id === payload.new.id ? payload.new : o));\n      }\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [questionId]);\n  const handleVote = async option => {\n    // show correct/incorrect feedback immediately\n    if (option.is_correct) {\n      setFeedback(\"Correct!\");\n    } else {\n      setFeedback(\"Incorrect — try again!\");\n    }\n\n    // update polls\n    if (userVote === option.id) return;\n\n    // decrement previous vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", {\n        option_id: userVote\n      });\n    }\n\n    // increment new vote\n    await supabase.rpc(\"increment_vote\", {\n      option_id: option.id\n    });\n\n    // update poll_votes table\n    await supabase.from(\"poll_votes\").upsert({\n      question_id: questionId,\n      user_id: userId,\n      option_id: option.id\n    });\n    setUserVote(option.id);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-6 border rounded-lg bg-white shadow-md max-w-xl\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"font-semibold text-lg mb-4\",\n      children: question\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-3\",\n      children: options.map(option => {\n        const isChosen = userVote === option.id;\n        return /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => handleVote(option),\n          className: `w-full text-left p-3 rounded-lg border transition\n                ${isChosen ? \"bg-blue-100 border-blue-500\" : \"bg-gray-50\"}\n              `,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: option.option_text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-sm text-gray-600\",\n              children: [option.votes, \" votes\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 132,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 15\n          }, this)\n        }, option.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), feedback && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-4 font-medium text-center\",\n      children: feedback\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 5\n  }, this);\n};\n_s(PollQuestion, \"SwK1u0Lwb19HRwGHp3BPGEIchBo=\");\n_c = PollQuestion;\nexport default PollQuestion;\nvar _c;\n$RefreshReg$(_c, \"PollQuestion\");","map":{"version":3,"names":["React","useEffect","useState","supabase","jsxDEV","_jsxDEV","PollQuestion","questionId","userId","_s","question","setQuestion","options","setOptions","userVote","setUserVote","feedback","setFeedback","fetchPoll","data","qData","error","qError","from","select","eq","single","console","question_text","oData","oError","order","vData","maybeSingle","option_id","channel","on","event","schema","table","filter","payload","eventType","prev","map","o","id","new","subscribe","removeChannel","handleVote","option","is_correct","rpc","upsert","question_id","user_id","className","children","fileName","_jsxFileName","lineNumber","columnNumber","isChosen","onClick","option_text","votes","_c","$RefreshReg$"],"sources":["/Users/doraliao/Desktop/Impact Team Project/Impact Team Project/src/components/PollQuestion.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../supabaseClient\";\n\ninterface PollOption {\n  id: number;\n  option_text: string;\n  votes: number;\n  is_correct: boolean;\n}\n\ninterface PollQuestionProps {\n  questionId: number;\n  userId: string;\n}\n\nconst PollQuestion: React.FC<PollQuestionProps> = ({ questionId, userId }) => {\n  const [question, setQuestion] = useState<string>(\"\");\n  const [options, setOptions] = useState<PollOption[]>([]);\n  const [userVote, setUserVote] = useState<number | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n\n  // Fetch question + options\n  const fetchPoll = async () => {\n    const { data: qData, error: qError } = await supabase\n      .from(\"poll_questions\")\n      .select()\n      .eq(\"id\", questionId)\n      .single();\n\n    if (qError) console.error(qError);\n    else setQuestion(qData.question_text);\n\n    const { data: oData, error: oError } = await supabase\n      .from(\"poll_options\")\n      .select()\n      .eq(\"question_id\", questionId)\n      .order(\"id\");\n\n    if (oError) console.error(oError);\n    else setOptions(oData as PollOption[]);\n\n    const { data: vData } = await supabase\n      .from(\"poll_votes\")\n      .select()\n      .eq(\"question_id\", questionId)\n      .eq(\"user_id\", userId)\n      .maybeSingle();\n\n    if (vData) setUserVote(vData.option_id);\n  };\n\n  // Realtime listener\n  useEffect(() => {\n    fetchPoll();\n\n    const channel = supabase\n      .channel(`poll-${questionId}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"*\",\n          schema: \"public\",\n          table: \"poll_options\",\n          filter: `question_id=eq.${questionId}`,\n        },\n        (payload: any) => {\n          if (payload.eventType === \"UPDATE\") {\n            setOptions((prev) =>\n              prev.map((o) => (o.id === payload.new.id ? payload.new : o))\n            );\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [questionId]);\n\n  const handleVote = async (option: PollOption) => {\n    // show correct/incorrect feedback immediately\n    if (option.is_correct) {\n      setFeedback(\"Correct!\");\n    } else {\n      setFeedback(\"Incorrect — try again!\");\n    }\n\n    // update polls\n    if (userVote === option.id) return;\n\n    // decrement previous vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", {\n        option_id: userVote,\n      });\n    }\n\n    // increment new vote\n    await supabase.rpc(\"increment_vote\", {\n      option_id: option.id,\n    });\n\n    // update poll_votes table\n    await supabase.from(\"poll_votes\").upsert({\n      question_id: questionId,\n      user_id: userId,\n      option_id: option.id,\n    });\n\n    setUserVote(option.id);\n  };\n\n  return (\n    <div className=\"p-6 border rounded-lg bg-white shadow-md max-w-xl\">\n      <h3 className=\"font-semibold text-lg mb-4\">{question}</h3>\n\n      <div className=\"space-y-3\">\n        {options.map((option) => {\n          const isChosen = userVote === option.id;\n\n          return (\n            <button\n              key={option.id}\n              onClick={() => handleVote(option)}\n              className={`w-full text-left p-3 rounded-lg border transition\n                ${isChosen ? \"bg-blue-100 border-blue-500\" : \"bg-gray-50\"}\n              `}\n            >\n              <div className=\"flex justify-between items-center\">\n                <span>{option.option_text}</span>\n                <span className=\"text-sm text-gray-600\">{option.votes} votes</span>\n              </div>\n            </button>\n          );\n        })}\n      </div>\n\n      {feedback && (\n        <p className=\"mt-4 font-medium text-center\">\n          {feedback}\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default PollQuestion;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}