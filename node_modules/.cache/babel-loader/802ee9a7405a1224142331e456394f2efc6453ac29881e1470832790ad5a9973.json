{"ast":null,"code":"var _jsxFileName = \"/Users/doraliao/Desktop/Impact Team Project/src/components/PollQuestion.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useCallback } from \"react\";\nimport { supabase } from \"../supabaseClient\";\nimport \"./PollQuestion.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PollQuestion = ({\n  questionId,\n  userId\n}) => {\n  _s();\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState([]);\n  const [userVote, setUserVote] = useState(null);\n  const [feedback, setFeedback] = useState(null);\n\n  // Fetch all poll data\n  const fetchPoll = useCallback(async () => {\n    const {\n      data: qData\n    } = await supabase.from(\"poll_questions\").select(\"*\").eq(\"id\", questionId).single();\n    if (qData) setQuestion(qData.question_text);\n    const {\n      data: oData\n    } = await supabase.from(\"poll_options\").select(\"*\").eq(\"question_id\", questionId).order(\"id\");\n    if (oData) setOptions(oData);\n    const {\n      data: vData\n    } = await supabase.from(\"poll_votes\").select(\"*\").eq(\"question_id\", questionId).eq(\"user_id\", userId).maybeSingle();\n    if (vData) setUserVote(vData.option_id);\n  }, [questionId, userId]);\n\n  // Realtime updates\n  useEffect(() => {\n    fetchPoll();\n    const channel = supabase.channel(`poll-${questionId}`).on(\"postgres_changes\", {\n      event: \"UPDATE\",\n      schema: \"public\",\n      table: \"poll_options\"\n    }, payload => {\n      const updated = payload.new;\n\n      // Only update relevant poll\n      if (updated.question_id !== questionId) return;\n      setOptions(prev => prev.map(o => o.id === updated.id ? updated : o));\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [questionId, fetchPoll]);\n\n  // User votes\n  const handleVote = async option => {\n    setFeedback(option.is_correct ? \"Correct!\" : \"Incorrect — try again!\");\n    if (userVote === option.id) return;\n\n    // remove previous vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", {\n        option_id: userVote\n      });\n    }\n\n    // add new vote\n    await supabase.rpc(\"increment_vote\", {\n      option_id: option.id\n    });\n    await supabase.from(\"poll_votes\").upsert({\n      question_id: questionId,\n      user_id: userId,\n      option_id: option.id\n    });\n    setUserVote(option.id);\n  };\n\n  // Compute total for percentages\n  const totalVotes = options.reduce((sum, o) => sum + o.votes, 0);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"poll-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"poll-question\",\n      children: question\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"poll-options-grid\",\n      children: options.map(option => {\n        const isChosen = userVote === option.id;\n        const percentage = totalVotes === 0 ? 0 : Math.round(option.votes / totalVotes * 100);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `poll-option-card ${isChosen ? \"selected\" : \"\"}`,\n          onClick: () => handleVote(option),\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"option-text\",\n            children: option.option_text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"option-votes\",\n            children: [percentage, \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 15\n          }, this)]\n        }, option.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this), feedback && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"poll-feedback\",\n      children: feedback\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 20\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n};\n_s(PollQuestion, \"p0IL7syA3q5YpUS7bH2qLN3OVR4=\");\n_c = PollQuestion;\nexport default PollQuestion;\nvar _c;\n$RefreshReg$(_c, \"PollQuestion\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","supabase","jsxDEV","_jsxDEV","PollQuestion","questionId","userId","_s","question","setQuestion","options","setOptions","userVote","setUserVote","feedback","setFeedback","fetchPoll","data","qData","from","select","eq","single","question_text","oData","order","vData","maybeSingle","option_id","channel","on","event","schema","table","payload","updated","new","question_id","prev","map","o","id","subscribe","removeChannel","handleVote","option","is_correct","rpc","upsert","user_id","totalVotes","reduce","sum","votes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","isChosen","percentage","Math","round","onClick","option_text","_c","$RefreshReg$"],"sources":["/Users/doraliao/Desktop/Impact Team Project/src/components/PollQuestion.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\nimport { supabase } from \"../supabaseClient\";\nimport \"./PollQuestion.css\";\n\ninterface PollOption {\n  id: number;\n  question_id: number;\n  option_text: string;\n  votes: number;\n  is_correct: boolean;\n}\n\ninterface PollQuestionProps {\n  questionId: number;\n  userId: string;\n}\n\nconst PollQuestion: React.FC<PollQuestionProps> = ({ questionId, userId }) => {\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState<PollOption[]>([]);\n  const [userVote, setUserVote] = useState<number | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n\n  // Fetch all poll data\n  const fetchPoll = useCallback(async () => {\n    const { data: qData } = await supabase\n      .from(\"poll_questions\")\n      .select(\"*\")\n      .eq(\"id\", questionId)\n      .single();\n\n    if (qData) setQuestion(qData.question_text);\n\n    const { data: oData } = await supabase\n      .from(\"poll_options\")\n      .select(\"*\")\n      .eq(\"question_id\", questionId)\n      .order(\"id\");\n\n    if (oData) setOptions(oData);\n\n    const { data: vData } = await supabase\n      .from(\"poll_votes\")\n      .select(\"*\")\n      .eq(\"question_id\", questionId)\n      .eq(\"user_id\", userId)\n      .maybeSingle();\n\n    if (vData) setUserVote(vData.option_id);\n  }, [questionId, userId]);\n\n  // Realtime updates\n  useEffect(() => {\n    fetchPoll();\n\n    const channel = supabase\n      .channel(`poll-${questionId}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"UPDATE\",\n          schema: \"public\",\n          table: \"poll_options\",\n        },\n        (payload) => {\n          const updated = payload.new as PollOption;\n\n          // Only update relevant poll\n          if (updated.question_id !== questionId) return;\n\n          setOptions((prev) =>\n            prev.map((o) => (o.id === updated.id ? updated : o))\n          );\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [questionId, fetchPoll]);\n\n  // User votes\n  const handleVote = async (option: PollOption) => {\n    setFeedback(option.is_correct ? \"Correct!\" : \"Incorrect — try again!\");\n\n    if (userVote === option.id) return;\n\n    // remove previous vote\n    if (userVote) {\n      await supabase.rpc(\"decrement_vote\", { option_id: userVote });\n    }\n\n    // add new vote\n    await supabase.rpc(\"increment_vote\", { option_id: option.id });\n\n    await supabase.from(\"poll_votes\").upsert({\n      question_id: questionId,\n      user_id: userId,\n      option_id: option.id,\n    });\n\n    setUserVote(option.id);\n  };\n\n  // Compute total for percentages\n  const totalVotes = options.reduce((sum, o) => sum + o.votes, 0);\n\n  return (\n    <div className=\"poll-container\">\n      <h3 className=\"poll-question\">{question}</h3>\n\n      <div className=\"poll-options-grid\">\n        {options.map((option) => {\n          const isChosen = userVote === option.id;\n          const percentage =\n            totalVotes === 0\n              ? 0\n              : Math.round((option.votes / totalVotes) * 100);\n\n          return (\n            <div\n              key={option.id}\n              className={`poll-option-card ${isChosen ? \"selected\" : \"\"}`}\n              onClick={() => handleVote(option)}\n            >\n              <p className=\"option-text\">{option.option_text}</p>\n              <p className=\"option-votes\">{percentage}%</p>\n            </div>\n          );\n        })}\n      </div>\n\n      {feedback && <p className=\"poll-feedback\">{feedback}</p>}\n    </div>\n  );\n};\n\nexport default PollQuestion;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}